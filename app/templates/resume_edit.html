{% extends "base.html" %}

{% block title %}Builder — {{ resume.title }} — HireMe Pro{% endblock %}

{% block content %}
<section class="builder">
    <div class="builder-grid">

        <div class="builder-form">
            <div class="builder-form-header">
                <div>
                    <h2>Resume Builder</h2>
                    <p class="builder-subtitle">Edit your resume and watch it come together.</p>
                </div>
                <div class="builder-header-btns">
                    <a href="{{ url_for('main.download_resume', id=resume.id) }}" class="btn-sm btn-download">PDF</a>
                    <a href="{{ url_for('main.resume_detail', id=resume.id) }}" class="btn-sm btn-back">View</a>
                    <a href="{{ url_for('main.dashboard') }}" class="btn-sm btn-back">Dashboard</a>
                </div>
            </div>

            <div class="builder-panel">
                <div class="panel-label">Basic Info</div>
                <form method="POST" action="{{ url_for('main.builder', id=resume.id) }}">
                    <div class="form-group">
                        <label for="title">Resume Title</label>
                        <input type="text" id="title" name="title" required
                               maxlength="150"
                               value="{{ resume.title }}">
                    </div>

                    <div class="form-group">
                        <label for="summary">Professional Summary</label>
                        <textarea id="summary" name="summary" rows="4">{{ resume.summary }}</textarea>
                    </div>

                    <button type="submit" class="btn-primary btn-full">Save Resume</button>
                </form>
            </div>

            <div class="builder-panel">
                <div class="panel-label-row">
                    <div class="panel-label">Experience</div>
                    <a href="{{ url_for('main.add_experience', resume_id=resume.id) }}" class="btn-xs btn-add">+ Add</a>
                </div>
                {% if resume.experiences %}
                    <div class="builder-entries">
                        {% for exp in resume.experiences %}
                            <div class="builder-entry">
                                <div class="builder-entry-info">
                                    <strong>{{ exp.role }}</strong>
                                    <span>{{ exp.company }}{% if exp.start_date %} · {{ exp.start_date }}{% if exp.end_date %} — {{ exp.end_date }}{% endif %}{% endif %}</span>
                                </div>
                                <div class="builder-entry-actions">
                                    <a href="{{ url_for('main.edit_experience', id=exp.id) }}" class="btn-xs btn-edit">Edit</a>
                                    <form method="POST" action="{{ url_for('main.delete_experience', id=exp.id) }}" class="inline-form"
                                          onsubmit="return confirm('Remove this entry?');">
                                        <button type="submit" class="btn-xs btn-delete">Del</button>
                                    </form>
                                </div>
                            </div>
                        {% endfor %}
                    </div>
                {% else %}
                    <div class="builder-empty-state">
                        <p>No experience yet</p>
                        <a href="{{ url_for('main.add_experience', resume_id=resume.id) }}">Add your first role</a>
                    </div>
                {% endif %}
            </div>

            <div class="builder-panel">
                <div class="panel-label-row">
                    <div class="panel-label">Education</div>
                    <a href="{{ url_for('main.add_education', resume_id=resume.id) }}" class="btn-xs btn-add">+ Add</a>
                </div>
                {% if resume.educations %}
                    <div class="builder-entries">
                        {% for edu in resume.educations %}
                            <div class="builder-entry">
                                <div class="builder-entry-info">
                                    <strong>{{ edu.school }}</strong>
                                    <span>{{ edu.degree }}{% if edu.start_date %} · {{ edu.start_date }}{% if edu.end_date %} — {{ edu.end_date }}{% endif %}{% endif %}</span>
                                </div>
                                <div class="builder-entry-actions">
                                    <a href="{{ url_for('main.edit_education', id=edu.id) }}" class="btn-xs btn-edit">Edit</a>
                                    <form method="POST" action="{{ url_for('main.delete_education', id=edu.id) }}" class="inline-form"
                                          onsubmit="return confirm('Remove this entry?');">
                                        <button type="submit" class="btn-xs btn-delete">Del</button>
                                    </form>
                                </div>
                            </div>
                        {% endfor %}
                    </div>
                {% else %}
                    <div class="builder-empty-state">
                        <p>No education yet</p>
                        <a href="{{ url_for('main.add_education', resume_id=resume.id) }}">Add your first school</a>
                    </div>
                {% endif %}
            </div>

            <div class="builder-panel">
                <div class="panel-label-row">
                    <div class="panel-label">Skills</div>
                    <a href="{{ url_for('main.add_skill', resume_id=resume.id) }}" class="btn-xs btn-add">+ Add</a>
                </div>
                {% if resume.skills %}
                    <div class="builder-entries">
                        {% for skill in resume.skills %}
                            <div class="builder-entry">
                                <div class="builder-entry-info">
                                    <strong>{{ skill.name }}</strong>
                                    {% if skill.level %}
                                        <span>{{ skill.level }}</span>
                                    {% endif %}
                                </div>
                                <div class="builder-entry-actions">
                                    <a href="{{ url_for('main.edit_skill', id=skill.id) }}" class="btn-xs btn-edit">Edit</a>
                                    <form method="POST" action="{{ url_for('main.delete_skill', id=skill.id) }}" class="inline-form"
                                          onsubmit="return confirm('Remove this skill?');">
                                        <button type="submit" class="btn-xs btn-delete">Del</button>
                                    </form>
                                </div>
                            </div>
                        {% endfor %}
                    </div>
                {% else %}
                    <div class="builder-empty-state">
                        <p>No skills yet</p>
                        <a href="{{ url_for('main.add_skill', resume_id=resume.id) }}">Add your first skill</a>
                    </div>
                {% endif %}
            </div>
        </div>

        <div class="builder-preview-wrapper">
            <div class="preview-toolbar">
                <div class="preview-label">Live Preview</div>
                <a href="{{ url_for('main.download_resume', id=resume.id) }}" class="btn-xs btn-download">Download PDF</a>
            </div>
            <div class="preview-shadow">
                <div class="resume-preview" id="resume-preview">
                    <div class="rv-header">
                        <h1 id="preview-title">{{ resume.title }}</h1>
                        <p class="rv-contact">{{ resume.owner.email }}</p>
                    </div>

                    <div class="rv-section" id="preview-summary-section">
                        <h2 class="rv-section-title">Summary</h2>
                        <p id="preview-summary">{{ resume.summary }}</p>
                    </div>

                    {% if resume.experiences %}
                        <div class="rv-section">
                            <h2 class="rv-section-title">Experience</h2>
                            {% for exp in resume.experiences %}
                                <div class="rv-entry">
                                    <div class="rv-entry-top">
                                        <strong>{{ exp.role }}</strong>
                                        <span class="rv-date">{{ exp.start_date }}{% if exp.end_date %} — {{ exp.end_date }}{% endif %}</span>
                                    </div>
                                    <div class="rv-company">{{ exp.company }}</div>
                                    {% if exp.description %}
                                        <p class="rv-desc">{{ exp.description }}</p>
                                    {% endif %}
                                </div>
                            {% endfor %}
                        </div>
                    {% endif %}

                    {% if resume.educations %}
                        <div class="rv-section">
                            <h2 class="rv-section-title">Education</h2>
                            {% for edu in resume.educations %}
                                <div class="rv-entry">
                                    <div class="rv-entry-top">
                                        <strong>{{ edu.school }}</strong>
                                        <span class="rv-date">{{ edu.start_date }}{% if edu.end_date %} — {{ edu.end_date }}{% endif %}</span>
                                    </div>
                                    {% if edu.degree %}
                                        <div class="rv-company">{{ edu.degree }}</div>
                                    {% endif %}
                                    {% if edu.description %}
                                        <p class="rv-desc">{{ edu.description }}</p>
                                    {% endif %}
                                </div>
                            {% endfor %}
                        </div>
                    {% endif %}

                    {% if resume.skills %}
                        <div class="rv-section">
                            <h2 class="rv-section-title">Skills</h2>
                            <div class="rv-skills">
                                {% for skill in resume.skills %}
                                    <span class="rv-skill-tag">{{ skill.name }}{% if skill.level %} · {{ skill.level }}{% endif %}</span>
                                {% endfor %}
                            </div>
                        </div>
                    {% endif %}

                    <div class="rv-empty-msg" id="preview-empty"
                         {% if resume.summary or resume.experiences or resume.educations or resume.skills %}style="display:none;"{% endif %}>
                        <div class="rv-empty-icon">&#9998;</div>
                        <p>Start adding content to see your resume take shape.</p>
                    </div>
                </div>
            </div>
        </div>

    </div>
</section>

<script src="{{ url_for('static', filename='js/preview.js') }}"></script>
{% endblock %}